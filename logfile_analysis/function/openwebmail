#!/bin/bash
#
# DnだR openwebmail o营A叭┮玻ネ logfile 戈啤A
# だR含O /var/log/openwebmail.log o永僧
# ヘe度だR
#	1. nJΩ计
#	2. 岿~nJΩ计
#	3. 肚eqllンΩ计I
#
# Writtern by VBird
#
# 2005/01/09    VBird   Released
#
#####################################################################
# Openwebmail 旱n魁戈篇亥\啜缂
funcopenwebmail () {
	echo "================= Openwebmail 旱n魁郎戈TJ俱 ======================="	>> $logfile
	grep "$y" /var/log/openwebmail.log > $basedir/openwebmaillog

	# 1. oΘ\nJ害讣啤I
	testing1=`grep 'login' $basedir/openwebmaillog | grep -v error`
	if [ "$testing1" != "" ]; then
		echo "Θ\nJ OpenWebmail 害讣撇苇pG"					>> $logfile
		echo "b腹 ㄓ方 Ω计" | \
			awk '{printf("%-6s %-10s %-15s %-4s\n", " ", $1, $2, $3)}'		>> $logfile
		grep 'login' $basedir/openwebmaillog | grep -v error | awk '{print $9 " " $8}'|\
			sed 's/(//g' | sed 's/)//g' | sort |\
			awk '{ for( i=0; i<1; i++ ) Number[$i]++ };
				END{ for( course in Number )
				printf( "%-25s %3d\n", course, Number[course])}' |\
			sort -k 3 -gr  | \
			awk '{printf("%-6s %-10s %-15s %3d\n", " ",$1, $2, $3)}'		>> $logfile
		echo " "									>> $logfile
		testing2=`grep 'send message' $basedir/openwebmaillog`
	fi

	# 2. pGΤnJLA氓Bт歃嘲eXlン伞
	if [ "$testing2" != "" ]; then
		echo "Qノ OpenWebmail oeXHン害讣撇苇pG"					>> $logfile
		echo "b腹 ㄓ方 Ω计" | \
			awk '{printf("%-6s %-10s %-15s %-4s\n", " ", $1, $2, $3)}'		>> $logfile
		grep 'send message' $basedir/openwebmaillog | awk '{print $9 " " $8}'|\
			sed 's/(//g' | sed 's/)//g' | sort |\
			awk '{ for( i=0; i<1; i++ ) Number[$i]++ };
				END{ for( course in Number )
				printf( "%-25s %3d\n", course, Number[course])}' |\
			sort -k 3 -gr  | \
			awk '{printf("%-6s %-10s %-15s %3d\n", " ",$1, $2, $3)}'		>> $logfile
		echo " "									>> $logfile
	fi
	
	# 3. 岿~nJ害讣啤I
	testing3=`grep 'login' $basedir/openwebmaillog | grep error`
	if [ "$testing3" != "" ]; then
		echo "nJア毖 OpenWebmail 害讣撇苇pG"					>> $logfile
		echo "b腹 ㄓ方 Ω计" | \
			awk '{printf("%-6s %-10s %-15s %-4s\n", " ", $1, $2, $3)}'		>> $logfile
		grep 'login' $basedir/openwebmaillog | grep  error | awk '{print $9 " " $8}'|\
			sed 's/(//g' | sed 's/)//g' | sort |\
			awk '{ for( i=0; i<1; i++ ) Number[$i]++ };
				END{ for( course in Number )
				printf( "%-25s %3d\n", course, Number[course])}' |\
			sort -k 3 -gr  | \
			awk '{printf("%-6s %-10s %-15s %3d\n", " ",$1, $2, $3)}'		>> $logfile
		echo " "									>> $logfile
	fi

	# 4. 常SΤヴ蟾臧T寒森浴I
	if [ "$testing1" == "" ] && [ "$testing2" == "" ] && [ "$testing3" == "" ] ; then
		echo "セらSΤヴ Open Webmail 焊臧T°"					>> $logfile
		echo " "									>> $logfile
	fi
	echo " "										>> $logfile
}
